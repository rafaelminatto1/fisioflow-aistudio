"use strict";(()=>{var e={};e.id=618,e.ids=[618],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},39455:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>g});var a=r(49303),n=r(88716),i=r(60670),o=r(87070),p=r(49237),l=r(93475),d=r(91585);let u=d.Ry({name:d.Z_().min(3,{message:"O nome deve ter pelo menos 3 caracteres."}),cpf:d.Z_().refine(e=>{let t;let r=e.replace(/[^\d]/g,"");if(11!==r.length||/^(\d)\1+$/.test(r))return!1;let s=0;for(let e=1;e<=9;e++)s+=parseInt(r.substring(e-1,e))*(11-e);if((10==(t=10*s%11)||11===t)&&(t=0),t!==parseInt(r.substring(9,10)))return!1;s=0;for(let e=1;e<=10;e++)s+=parseInt(r.substring(e-1,e))*(12-e);return(10==(t=10*s%11)||11===t)&&(t=0),t===parseInt(r.substring(10,11))},{message:"CPF inv\xe1lido."}),birthDate:d.Z_().optional(),phone:d.Z_().optional(),email:d.Z_().email({message:"Email inv\xe1lido."}).optional().or(d.i0("")),addressZip:d.Z_().optional(),addressStreet:d.Z_().optional(),addressNumber:d.Z_().optional(),addressCity:d.Z_().optional(),addressState:d.Z_().optional(),emergencyContactName:d.Z_().optional(),emergencyContactPhone:d.Z_().optional(),allergies:d.Z_().optional(),medicalAlerts:d.Z_().optional(),consentGiven:d.O7().refine(e=>!0===e,{message:"O consentimento LGPD \xe9 obrigat\xf3rio."}),whatsappConsent:d.Km(["opt_in","opt_out"])});var c=r(26033);async function m(e){let{searchParams:t}=new URL(e.url),r=t.get("cursor")||void 0,s=t.get("q")||"",a=t.get("status")||"",n=`patients_list:cursor=${r}&q=${s}&status=${a}`;try{let e=await l.Z,t=await e.get(n);if(t)return o.NextResponse.json(JSON.parse(t));let i={OR:[{name:{contains:s,mode:"insensitive"}},{cpf:{contains:s,mode:"insensitive"}}]};a&&"All"!==a&&(i.status=a);let d=await p.qL.client.patient.findMany({take:20,skip:r?1:0,cursor:r?{id:r}:void 0,where:i,select:{id:!0,name:!0,cpf:!0,phone:!0,status:!0},orderBy:{createdAt:"desc"}}),u=20===d.length?d[d.length-1].id:null,c={items:d,nextCursor:u};return await e.set(n,JSON.stringify(c),{EX:300}),o.NextResponse.json(c)}catch(e){return console.error("[API_PACIENTES_GET]",e),new o.NextResponse("Internal Server Error",{status:500})}}async function g(e){try{let t=await e.json(),r=u.parse(t),s=await p.qL.client.patient.create({data:{name:r.name,cpf:r.cpf,birthDate:r.birthDate?new Date(r.birthDate):null,phone:r.phone,email:r.email,address:r.addressZip||r.addressStreet||r.addressNumber||r.addressCity||r.addressState?{zip:r.addressZip,street:r.addressStreet,number:r.addressNumber,city:r.addressCity,state:r.addressState}:void 0,emergencyContact:r.emergencyContactName||r.emergencyContactPhone?{name:r.emergencyContactName,phone:r.emergencyContactPhone}:void 0,allergies:r.allergies,medicalAlerts:r.medicalAlerts,consentGiven:r.consentGiven,whatsappConsent:r.whatsappConsent}}),a=await l.Z;return await a.flushAll(),o.NextResponse.json(s,{status:201})}catch(e){if(console.error("[API_PACIENTES_POST]",e),e instanceof c.jm)return new o.NextResponse(JSON.stringify(e.errors),{status:400});return new o.NextResponse("Internal Server Error",{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pacientes/route",pathname:"/api/pacientes",filename:"route",bundlePath:"app/api/pacientes/route"},resolvedPagePath:"C:\\Users\\amand\\Rafael\\aifisio\\fisioflow-aistudio\\app\\api\\pacientes\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:x}=h,y="/api/pacientes/route";function _(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[216,237],()=>r(39455));module.exports=s})();