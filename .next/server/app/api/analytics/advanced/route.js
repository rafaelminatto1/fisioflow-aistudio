"use strict";(()=>{var e={};e.id=368,e.ids=[368],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},81064:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>eT,patchFetch:()=>eI,requestAsyncStorage:()=>eA,routeModule:()=>ew,serverHooks:()=>ev,staticGenerationAsyncStorage:()=>eO});var a,s,i,r,o,c,l,d,u,h,m,p,g={};n.r(g),n.d(g,{GET:()=>ep});var f=n(49303),E=n(88716),y=n(60670),C=n(87070),w=n(90455),A=n(49237),O=n(33866),v=n(16836),T=n(67754);(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(a||(a={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(s||(s={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(i||(i={}));let I=["user","model","function","system"];(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(r||(r={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(o||(o={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(c||(c={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(l||(l={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(d||(d={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(u||(u={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(h||(h={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(m||(m={}));class R extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class N extends R{constructor(e,t){super(e),this.response=t}}class S extends R{constructor(e,t,n,a){super(e),this.status=t,this.statusText=n,this.errorDetails=a}}class _ extends R{}class x extends R{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(p||(p={}));class D{constructor(e,t,n,a,s){this.model=e,this.task=t,this.apiKey=n,this.stream=a,this.requestOptions=s}toString(){var e,t;let n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",a=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",s=`${a}/${n}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}async function P(e){var t;let n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let a=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(e){throw new _(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${e.message}`)}for(let[e,t]of a.entries()){if("x-goog-api-key"===e)throw new _(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new _(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function b(e,t,n,a,s,i){let r=new D(e,t,n,a,i);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await P(r),body:s})}}async function M(e,t,n,a,s,i={},r=fetch){let{url:o,fetchOptions:c}=await b(e,t,n,a,s,i);return $(o,c,r)}async function $(e,t,n=fetch){let a;try{a=await n(e,t)}catch(t){(function(e,t){let n=e;throw"AbortError"===n.name?(n=new x(`Request aborted when fetching ${t.toString()}: ${e.message}`)).stack=e.stack:e instanceof S||e instanceof _||((n=new R(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),n})(t,e)}return a.ok||await L(a,e),a}async function L(e,t){let n,a="";try{let t=await e.json();a=t.error.message,t.error.details&&(a+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new S(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${a}`,e.status,e.statusText,n)}function U(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),F(e.candidates[0]))throw new N(`${j(e)}`,e);return function(e){var t,n,a,s;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(s=null===(a=e.candidates)||void 0===a?void 0:a[0].content)||void 0===s?void 0:s.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new N(`Text not available. ${j(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),F(e.candidates[0]))throw new N(`${j(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),k(e)[0]}if(e.promptFeedback)throw new N(`Function call not available. ${j(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),F(e.candidates[0]))throw new N(`${j(e)}`,e);return k(e)}if(e.promptFeedback)throw new N(`Function call not available. ${j(e)}`,e)},e}function k(e){var t,n,a,s;let i=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(s=null===(a=e.candidates)||void 0===a?void 0:a[0].content)||void 0===s?void 0:s.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let H=[d.RECITATION,d.SAFETY,d.LANGUAGE];function F(e){return!!e.finishReason&&H.includes(e.finishReason)}function j(e){var t,n,a;let s="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)s+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(a=e.candidates)||void 0===a?void 0:a[0]){let t=e.candidates[0];F(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}return s}function B(e){return this instanceof B?(this.v=e,this):new B(e)}"function"==typeof SuppressedError&&SuppressedError;let G=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function q(e){let t=[],n=e.getReader();for(;;){let{done:e,value:a}=await n.read();if(e)return U(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let a of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=a.citationMetadata,n.candidates[e].groundingMetadata=a.groundingMetadata,n.candidates[e].finishReason=a.finishReason,n.candidates[e].finishMessage=a.finishMessage,n.candidates[e].safetyRatings=a.safetyRatings,a.content&&a.content.parts){n.candidates[e].content||(n.candidates[e].content={role:a.content.role||"user",parts:[]});let t={};for(let s of a.content.parts)s.text&&(t.text=s.text),s.functionCall&&(t.functionCall=s.functionCall),s.executableCode&&(t.executableCode=s.executableCode),s.codeExecutionResult&&(t.codeExecutionResult=s.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(a)}}async function Y(e,t,n,a){return function(e){let[t,n]=(function(e){let t=e.getReader();return new ReadableStream({start(e){let n="";return function a(){return t.read().then(({value:t,done:s})=>{let i;if(s){if(n.trim()){e.error(new R("Failed to parse stream"));return}e.close();return}let r=(n+=t).match(G);for(;r;){try{i=JSON.parse(r[1])}catch(t){e.error(new R(`Error parsing JSON response: "${r[1]}"`));return}e.enqueue(i),r=(n=n.substring(r[0].length)).match(G)}return a()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new x("Request aborted when reading from the stream"):new R("Error reading from the stream")})}()}})})(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var a,s=n.apply(e,t||[]),i=[];return a={},r("next"),r("throw"),r("return"),a[Symbol.asyncIterator]=function(){return this},a;function r(e){s[e]&&(a[e]=function(t){return new Promise(function(n,a){i.push([e,t,n,a])>1||o(e,t)})})}function o(e,t){try{var n;(n=s[e](t)).value instanceof B?Promise.resolve(n.value.v).then(c,l):d(i[0][2],n)}catch(e){d(i[0][3],e)}}function c(e){o("next",e)}function l(e){o("throw",e)}function d(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield B(t.read());if(n)break;yield yield B(U(e))}})}(t),response:q(n)}}(await M(t,p.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),a))}async function K(e,t,n,a){let s=await M(t,p.GENERATE_CONTENT,e,!1,JSON.stringify(n),a);return{response:U(await s.json())}}function V(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function J(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){let t={role:"user",parts:[]},n={role:"function",parts:[]},a=!1,s=!1;for(let i of e)"functionResponse"in i?(n.parts.push(i),s=!0):(t.parts.push(i),a=!0);if(a&&s)throw new R("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!s)throw new R("No content is provided for sending chat message.");return a?t:n}(t)}function z(e){let t;return t=e.contents?e:{contents:[J(e)]},e.systemInstruction&&(t.systemInstruction=V(e.systemInstruction)),t}let Z=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],W={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function X(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let Q="SILENT_ERROR";class ee{constructor(e,t,n,a={}){this.model=t,this.params=n,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(function(e){let t=!1;for(let n of e){let{role:e,parts:a}=n;if(!t&&"user"!==e)throw new R(`First content should be with role 'user', got ${e}`);if(!I.includes(e))throw new R(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(I)}`);if(!Array.isArray(a))throw new R("Content should have 'parts' property with an array of Parts");if(0===a.length)throw new R("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of a)for(let t of Z)t in e&&(s[t]+=1);let i=W[e];for(let t of Z)if(!i.includes(t)&&s[t]>0)throw new R(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,a,s,i,r,o;let c;await this._sendPromise;let l=J(e),d={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(a=this.params)||void 0===a?void 0:a.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(r=this.params)||void 0===r?void 0:r.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>K(this._apiKey,this.model,d,u)).then(e=>{var t;if(X(e.response)){this._history.push(l);let n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{let t=j(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}c=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,c}async sendMessageStream(e,t={}){var n,a,s,i,r,o;await this._sendPromise;let c=J(e),l={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(a=this.params)||void 0===a?void 0:a.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(i=this.params)||void 0===i?void 0:i.toolConfig,systemInstruction:null===(r=this.params)||void 0===r?void 0:r.systemInstruction,cachedContent:null===(o=this.params)||void 0===o?void 0:o.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t),u=Y(this._apiKey,this.model,l,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(Q)}).then(e=>e.response).then(e=>{if(X(e)){this._history.push(c);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=j(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==Q&&console.error(e)}),u}}async function et(e,t,n,a){return(await M(t,p.COUNT_TOKENS,e,!1,JSON.stringify(n),a)).json()}async function en(e,t,n,a){return(await M(t,p.EMBED_CONTENT,e,!1,JSON.stringify(n),a)).json()}async function ea(e,t,n,a){let s=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await M(t,p.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),a)).json()}class es{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=V(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let a=z(e),s=Object.assign(Object.assign({},this._requestOptions),t);return K(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},a),s)}async generateContentStream(e,t={}){var n;let a=z(e),s=Object.assign(Object.assign({},this._requestOptions),t);return Y(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},a),s)}startChat(e){var t;return new ee(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let a={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]},s=null!=e.generateContentRequest;if(e.contents){if(s)throw new _("CountTokensRequest must have one of contents or generateContentRequest, not both.");a.contents=e.contents}else if(s)a=Object.assign(Object.assign({},a),e.generateContentRequest);else{let t=J(e);a.contents=[t]}return{generateContentRequest:a}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),t);return et(this.apiKey,this.model,n,a)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:J(e)}:e,a=Object.assign(Object.assign({},this._requestOptions),t);return en(this.apiKey,this.model,n,a)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return ea(this.apiKey,this.model,e,n)}}class ei{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new R("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new es(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new _("Cached content must contain a `name` field.");if(!e.model)throw new _("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new _(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new es(this.apiKey,a,n)}}let er={DEFAULT_TIMEOUT:5e3,CACHE_TTL:{SHORT:60,MEDIUM:300,LONG:1800,VERY_LONG:3600}},eo={minimal:{id:!0,name:!0,email:!0,role:!0}};async function ec(e,t){let n=Date.now();try{let a=await t(),s=Date.now()-n;return s>er.DEFAULT_TIMEOUT&&console.warn(`🐌 Slow query detected: ${e} took ${s}ms`),a}catch(a){let t=Date.now()-n;throw console.error(`❌ Query failed: ${e} after ${t}ms`,a),a}}({minimal:{id:!0,name:!0,phone:!0,status:!0},basic:{id:!0,name:!0,email:!0,phone:!0,dateOfBirth:!0,status:!0,createdAt:!0,userId:!0},withUser:{id:!0,name:!0,email:!0,phone:!0,dateOfBirth:!0,status:!0,createdAt:!0,user:{select:eo.minimal}},full:{id:!0,name:!0,email:!0,phone:!0,dateOfBirth:!0,address:!0,emergencyContact:!0,medicalHistory:!0,status:!0,createdAt:!0,updatedAt:!0,userId:!0}}).minimal,eo.minimal;class el{set(e,t,n){let a=Date.now()+1e3*n;this.cache.set(e,{data:t,expires:a})}get(e){let t=this.cache.get(e);return t?Date.now()>t.expires?(this.cache.delete(e),null):t.data:null}clear(){this.cache.clear()}size(){return this.cache.size}constructor(){this.cache=new Map}}let ed=new el;async function eu(e,t,n=er.CACHE_TTL.MEDIUM){let a=ed.get(e);if(a)return a;let s=await t();return ed.set(e,s,n),s}class eh{constructor(){let e=process.env.GOOGLE_AI_API_KEY;if(!e){O.aw.warn("Google AI API key not configured");return}this.genAI=new ei(e),this.model=this.genAI.getGenerativeModel({model:"gemini-1.5-flash"})}async generatePatientInsights(e){return eu(`patient_insights_${e}`,async()=>{try{let t=await this.gatherPatientData(e);if(!t)return null;let n=await this.analyzePatientData(t);return await this.storePatientInsights(e,n),T.B1.recordBusinessEvent("ai_patient_insight_generated",{patientId:e,riskLevel:n.riskLevel}),n}catch(t){return O.aw.error("Failed to generate patient insights",{patientId:e,error:t.message}),null}},1800)}async generateTreatmentRecommendations(e){return eu(`treatment_recommendations_${e}`,async()=>{try{let t=await this.gatherPatientData(e);if(!t)return[];let n=await this.generateRecommendationsWithAI(t);return T.B1.recordBusinessEvent("ai_treatment_recommendations_generated",{patientId:e,recommendationCount:n.length}),n}catch(t){return O.aw.error("Failed to generate treatment recommendations",{patientId:e,error:t.message}),[]}},3600)}async generateClinicInsights(e){return eu(`clinic_insights_${e}`,async()=>{try{let t=await this.gatherClinicData(e),n=await this.analyzeClinicData(t);return T.B1.recordBusinessEvent("ai_clinic_insights_generated",{therapistId:e,alertCount:n.alerts.length}),n}catch(t){return O.aw.error("Failed to generate clinic insights",{therapistId:e,error:t.message}),null}},7200)}async gatherPatientData(e){return await A.ZP.client.patient.findUnique({where:{id:e},include:{appointments:{orderBy:{startTime:"desc"},take:20,include:{therapist:{select:{name:!0}}}},painPoints:{orderBy:{createdAt:"desc"},take:10},metricResults:{orderBy:{measuredAt:"desc"},take:20},soapNotes:{orderBy:{createdAt:"desc"},take:10}}})}async gatherClinicData(e){let[t,n,a]=await Promise.all([A.ZP.client.patient.findMany({where:{appointments:{some:{therapistId:e}}},include:{appointments:{where:{therapistId:e},orderBy:{startTime:"desc"}},painPoints:!0,metricResults:!0}}),A.ZP.client.appointment.findMany({where:{therapistId:e,startTime:{gte:new Date(Date.now()-7776e6)}},include:{patient:{select:{name:!0,status:!0}}}}),A.ZP.client.painPoint.findMany({where:{patient:{appointments:{some:{therapistId:e}}}},include:{patient:{select:{name:!0}}}})]);return{patients:t,appointments:n,painPoints:a}}async analyzePatientData(e){return(0,v.M3)("google_ai","patient_analysis",async()=>{let t=this.buildPatientAnalysisPrompt(e),n=(await this.model.generateContent(t)).response.text(),a=this.parsePatientAnalysis(n,e);return{patientId:e.id,patientName:e.name,riskLevel:a.riskLevel,insights:a.insights,predictions:a.predictions,generatedAt:new Date}})}async generateRecommendationsWithAI(e){return(0,v.M3)("google_ai","treatment_recommendations",async()=>{let t=this.buildRecommendationPrompt(e),n=(await this.model.generateContent(t)).response.text();return this.parseRecommendations(n,e.id)})}async analyzeClinicData(e){return(0,v.M3)("google_ai","clinic_analysis",async()=>{let t=this.buildClinicAnalysisPrompt(e),n=(await this.model.generateContent(t)).response.text();return this.parseClinicAnalysis(n,e)})}buildPatientAnalysisPrompt(e){let t=e.appointments.slice(0,10),n=e.painPoints.slice(0,5),a=e.metricResults.slice(0,10);return`
Voc\xea \xe9 um especialista em fisioterapia com IA avan\xe7ada. Analise os dados do paciente abaixo e forne\xe7a insights detalhados.

DADOS DO PACIENTE:
Nome: ${e.name}
Status: ${e.status}
Data de nascimento: ${e.dateOfBirth}
Hist\xf3rico m\xe9dico: ${e.medicalHistory||"N\xe3o informado"}

CONSULTAS RECENTES (${t.length}):
${t.map(e=>`- ${e.startTime}: ${e.type} (Status: ${e.status}) - Terapeuta: ${e.therapist?.name}`).join("\n")}

PONTOS DE DOR RECENTES (${n.length}):
${n.map(e=>`- ${e.bodyPart}: ${e.type} (Intensidade: ${e.intensity}/10) - ${e.description}`).join("\n")}

M\xc9TRICAS RECENTES (${a.length}):
${a.map(e=>`- ${e.metricName}: ${e.value} ${e.unit} (${e.measuredAt})`).join("\n")}

Por favor, forne\xe7a uma an\xe1lise estruturada incluindo:

1. N\xcdVEL DE RISCO (low/medium/high/critical) e justificativa
2. PROGRESSO DA RECUPERA\xc7\xc3O (0-100%) e tend\xeancia (improving/stable/declining)
3. AN\xc1LISE DE FREQU\xcaNCIA (taxa de comparecimento e padr\xe3o)
4. AN\xc1LISE DA DOR (tend\xeancia e intensidade m\xe9dia)
5. N\xcdVEL DE ENGAJAMENTO e fatores
6. PREDI\xc7\xd5ES (probabilidade de alta e fatores de risco)
7. A\xc7\xd5ES RECOMENDADAS

Seja espec\xedfico e baseie-se em evid\xeancias cl\xednicas.
    `}buildRecommendationPrompt(e){return`
Como especialista em fisioterapia, gere recomenda\xe7\xf5es espec\xedficas para este paciente:

PACIENTE: ${e.name}
CONDI\xc7\xc3O: ${e.medicalHistory||"A definir"}
STATUS: ${e.status}

DADOS CL\xcdNICOS:
${e.appointments.slice(0,5).map(e=>`- Consulta ${e.type}: ${e.status} (Notas: ${e.notes||"Sem notas"})`).join("\n")}

${e.painPoints.slice(0,3).map(e=>`- Dor em ${e.bodyPart}: ${e.intensity}/10`).join("\n")}

Gere 3-5 recomenda\xe7\xf5es espec\xedficas com:
- Categoria (exercise/frequency/duration/technique/referral)
- Prioridade (high/medium/low)
- Recomenda\xe7\xe3o detalhada
- Justificativa baseada em evid\xeancia
- Resultado esperado
- Passos de implementa\xe7\xe3o
- N\xedvel de confian\xe7a (0-100%)

Foque em abordagens baseadas em evid\xeancias cient\xedficas.
    `}buildClinicAnalysisPrompt(e){let{patients:t,appointments:n}=e;return`
Analise os dados da cl\xednica de fisioterapia e forne\xe7a insights estrat\xe9gicos:

DADOS GERAIS:
- Total de pacientes: ${t.length}
- Consultas nos \xfaltimos 90 dias: ${n.length}
- Pacientes ativos: ${t.filter(e=>"Active"===e.status).length}

PADR\xd5ES DE CONSULTAS:
${this.getAppointmentPatterns(n)}

AN\xc1LISE DE CONDI\xc7\xd5ES:
${this.getConditionAnalysis(t)}

Forne\xe7a:
1. VIS\xc3O GERAL (m\xe9tricas principais)
2. PADR\xd5ES IDENTIFICADOS
3. PERFORMANCE DO TRATAMENTO
4. ALERTAS CR\xcdTICOS
5. RECOMENDA\xc7\xd5ES (operacionais, cl\xednicas, comerciais)

Seja estrat\xe9gico e orientado por dados.
    `}getAppointmentPatterns(e){return Object.entries(e.reduce((e,t)=>{let n=new Date(t.startTime).toLocaleDateString("pt-BR",{weekday:"long"});return e[n]=(e[n]||0)+1,e},{})).map(([e,t])=>`${e}: ${t} consultas`).join("\n")}getConditionAnalysis(e){let t={};return e.forEach(e=>{e.medicalHistory&&(t[e.medicalHistory]=(t[e.medicalHistory]||0)+1)}),Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>`${e}: ${t} pacientes`).join("\n")}parsePatientAnalysis(e,t){let n=this.extractRiskLevel(e),a=this.extractProgress(e);return{riskLevel:n,insights:{recovery:{progress:a,trend:a>70?"improving":a>40?"stable":"declining",analysis:e.slice(0,200)+"..."},attendance:{rate:this.calculateAttendanceRate(t.appointments),pattern:"consistent",analysis:"An\xe1lise baseada nos dados de comparecimento"},pain:{trend:this.analyzePainTrend(t.painPoints),avgIntensity:this.calculateAvgPainIntensity(t.painPoints),analysis:"An\xe1lise da evolu\xe7\xe3o da dor baseada nos registros"},engagement:{level:"medium",factors:["Comparecimento regular","Relat\xf3rios de dor consistentes"],recommendations:["Aumentar frequ\xeancia de exerc\xedcios","Melhorar comunica\xe7\xe3o"]}},predictions:{dischargeProbability:Math.min(a+20,100),riskFactors:this.identifyRiskFactors(e),recommendedActions:this.extractRecommendedActions(e)}}}parseRecommendations(e,t){let n=[];return n.push({patientId:t,category:"exercise",priority:"high",recommendation:"Aumentar frequ\xeancia de exerc\xedcios de fortalecimento",reasoning:"Baseado na an\xe1lise dos dados de recupera\xe7\xe3o",expectedOutcome:"Melhora de 20-30% na for\xe7a muscular em 4 semanas",implementationSteps:["Avaliar capacidade atual","Definir programa progressivo","Monitorar evolu\xe7\xe3o semanalmente"],confidence:85}),n}parseClinicAnalysis(e,t){let{patients:n,appointments:a}=t;return{overview:{totalPatients:n.length,activePatients:n.filter(e=>"Active"===e.status).length,completionRate:75,avgSessionsPerPatient:a.length/n.length},patterns:{mostCommonConditions:[],busyDays:[],seasonalTrends:[]},performance:{therapistEfficiency:[],treatmentSuccess:[]},alerts:[{type:"capacity_warning",severity:"medium",message:"Capacidade pr\xf3xima do limite nos hor\xe1rios de pico",actionRequired:"Considerar expandir hor\xe1rios de atendimento"}],recommendations:{operational:["Otimizar agendamentos para melhor distribui\xe7\xe3o"],clinical:["Implementar protocolos padronizados"],business:["Analisar oportunidades de expans\xe3o"]}}}extractRiskLevel(e){let t=e.toLowerCase();return t.includes("critical")||t.includes("cr\xedtico")?"critical":t.includes("high")||t.includes("alto")?"high":t.includes("medium")||t.includes("m\xe9dio")?"medium":"low"}extractProgress(e){let t=e.match(/(\d+)%/);return t?parseInt(t[1]):50}calculateAttendanceRate(e){let t=e.filter(e=>"Conclu\xeddo"===e.status).length;return e.length>0?Math.round(t/e.length*100):0}analyzePainTrend(e){if(e.length<2)return"stable";let t=e.slice(0,3).reduce((e,t)=>e+t.intensity,0)/3,n=e.slice(3,6).reduce((e,t)=>e+t.intensity,0)/3;return t<n-1?"improving":t>n+1?"worsening":"stable"}calculateAvgPainIntensity(e){return 0===e.length?0:Math.round(e.reduce((e,t)=>e+t.intensity,0)/e.length)}identifyRiskFactors(e){let t=[];return e.toLowerCase().includes("irregular")&&t.push("Comparecimento irregular"),e.toLowerCase().includes("pain")&&t.push("Dor persistente"),t}extractRecommendedActions(e){return["Acompanhar evolu\xe7\xe3o semanalmente","Ajustar plano de tratamento conforme necess\xe1rio","Manter comunica\xe7\xe3o regular com paciente"]}async storePatientInsights(e,t){try{await A.ZP.client.$executeRaw`
        INSERT INTO "PatientInsights" ("patientId", "riskLevel", "insights", "generatedAt")
        VALUES (${e}, ${t.riskLevel}, ${JSON.stringify(t.insights)}::jsonb, ${t.generatedAt})
        ON CONFLICT ("patientId") 
        DO UPDATE SET 
          "riskLevel" = EXCLUDED."riskLevel",
          "insights" = EXCLUDED."insights",
          "generatedAt" = EXCLUDED."generatedAt";
      `}catch(t){O.aw.error("Failed to store patient insights",{patientId:e,error:t})}}async healthCheck(){try{if(!process.env.GOOGLE_AI_API_KEY)return{status:"unhealthy",error:"Google AI API key not configured"};let e=await this.model.generateContent("Hello, this is a health check test.");if(e&&e.response)return{status:"healthy"};return{status:"unhealthy",error:"Invalid AI response"}}catch(e){return{status:"unhealthy",error:e.message}}}}let em=new eh;async function ep(e){return ec("advanced_analytics_fetch",async()=>{try{let t=await (0,w.I8)();if(!t?.user)return C.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),a=n.get("userId")||t.user.id,s=n.get("range")||"30d",i=new Date,r="7d"===s?7:"30d"===s?30:"90d"===s?90:365,o=new Date(i.getTime()-864e5*r),[c,l,d,u,h]=await Promise.all([eg(a,o),ef(a),eE(a,o),ey(a),eC(a)]),m={overview:c,patientInsights:l,performance:d,alerts:u,predictions:h,generatedAt:new Date().toISOString(),timeRange:s};return T.B1.recordAPICall("analytics","GET",200),O.aw.info("Advanced analytics dashboard generated",{userId:a,range:s,patientCount:l.length,alertCount:u.length}),C.NextResponse.json(m)}catch(e){return O.aw.error("Failed to generate advanced analytics",{error:e.message,stack:e.stack}),T.B1.recordAPICall("analytics","GET",500),C.NextResponse.json({error:"Failed to generate analytics"},{status:500})}})}async function eg(e,t){let[n,a,s,i,r]=await Promise.all([A.ZP.client.patient.count({where:{appointments:{some:{therapistId:e}}}}),A.ZP.client.patient.count({where:{status:"Active",appointments:{some:{therapistId:e}}}}),A.ZP.client.appointment.count({where:{therapistId:e,status:"Realizado",startTime:{gte:t}}}),A.ZP.client.appointment.count({where:{therapistId:e,startTime:{gte:t}}}),A.ZP.client.patient.count({where:{appointments:{some:{therapistId:e}},createdAt:{gte:new Date(Date.now()-5184e6),lte:new Date(Date.now()-2592e6)}}})]),o=await A.ZP.client.appointment.groupBy({by:["patientId"],where:{therapistId:e,startTime:{gte:t}},_count:{id:!0}});return{totalPatients:n,activePatients:a,completionRate:i>0?Math.round(s/i*100):0,avgSessionsPerPatient:Math.round(10*(o.length>0?o.reduce((e,t)=>e+t._count.id,0)/o.length:0))/10,monthlyGrowth:r>0?Math.round((a-r)/r*100):0}}async function ef(e){let t=await A.ZP.client.patient.findMany({where:{appointments:{some:{therapistId:e}}},include:{appointments:{where:{therapistId:e},orderBy:{startTime:"desc"},take:10},painPoints:{orderBy:{createdAt:"desc"},take:5}},take:50});return(await Promise.all(t.map(async e=>{let t=e.appointments.filter(e=>"Realizado"===e.status).length,n=e.appointments.length,a=n>0?Math.round(t/n*100):0,s=function(e){if(e.length<2)return"stable";let t=e.slice(0,2).reduce((e,t)=>e+t.intensity,0)/2,n=e.slice(2,4).reduce((e,t)=>e+t.intensity,0)/2;return t<n-1?"improving":t>n+1?"worsening":"stable"}(e.painPoints),i=Math.min(Math.round(10*t+.5*a+("improving"===s?20:"stable"===s?10:0)),100);return{patientId:e.id,patientName:e.name,riskLevel:a<50||"worsening"===s&&i<30?"critical":a<70||i<40?"high":a<85||i<70?"medium":"low",recoveryProgress:i,attendanceRate:a,painTrend:s}}))).sort((e,t)=>{let n={critical:0,high:1,medium:2,low:3};return n[e.riskLevel]-n[t.riskLevel]})}async function eE(e,t){let n=await A.ZP.client.$queryRaw`
    SELECT 
      DATE_TRUNC('week', "startTime") as week,
      COUNT(*) as appointments,
      COUNT(CASE WHEN status = 'Realizado' THEN 1 END) as completed,
      COUNT(CASE WHEN status = 'Falta' THEN 1 END) as "noShow"
    FROM "Appointment"
    WHERE "therapistId" = ${e}
      AND "startTime" >= ${t}
    GROUP BY week
    ORDER BY week;
  `,a=await A.ZP.client.$queryRaw`
    SELECT 
      type as "treatmentType",
      COUNT(*) as "patientCount",
      COUNT(CASE WHEN status = 'Realizado' THEN 1 END) * 100.0 / COUNT(*) as "successRate",
      AVG(EXTRACT(DAY FROM (CURRENT_DATE - DATE("startTime")))) as "avgDuration"
    FROM "Appointment"
    WHERE "therapistId" = ${e}
      AND "startTime" >= ${t}
    GROUP BY type
    ORDER BY "successRate" DESC;
  `,s=function(e){let t=[],n=["Jan","Fev","Mar","Abr","Mai","Jun"];for(let e=0;e<6;e++)t.push({month:n[e],avgPainReduction:Math.round(30+40*Math.random()),patientsSurvey:Math.round(20+30*Math.random())});return t}(0);return{weeklyAppointments:n.map(e=>({week:new Date(e.week).toLocaleDateString("pt-BR"),appointments:Number(e.appointments),completed:Number(e.completed),noShow:Number(e.noShow)})),treatmentSuccess:a.map(e=>({treatmentType:e.treatmentType,successRate:Math.round(Number(e.successRate)),avgDuration:Math.round(Number(e.avgDuration)||0),patientCount:Number(e.patientCount)})),painReductionTrends:s}}async function ey(e){let t=[];return(await A.ZP.client.$queryRaw`
    SELECT 
      p.id,
      p.name,
      COUNT(*) as total_appointments,
      COUNT(CASE WHEN a.status = 'Falta' THEN 1 END) as missed_appointments
    FROM "Patient" p
    JOIN "Appointment" a ON p.id = a."patientId"
    WHERE a."therapistId" = ${e}
      AND a."startTime" >= ${new Date(Date.now()-2592e6)}
    GROUP BY p.id, p.name
    HAVING COUNT(CASE WHEN a.status = 'Falta' THEN 1 END) > 2
    ORDER BY missed_appointments DESC;
  `).forEach(e=>{t.push({type:"patient_risk",severity:"high",message:"Paciente com alto \xedndice de faltas",patientName:e.name,actionRequired:"Entrar em contato para verificar situa\xe7\xe3o",timestamp:new Date().toISOString()})}),await A.ZP.client.appointment.count({where:{therapistId:e,startTime:{gte:new Date(new Date().setHours(0,0,0,0)),lte:new Date(new Date().setHours(23,59,59,999))}}})>8&&t.push({type:"capacity_warning",severity:"medium",message:"Agenda com alta demanda hoje",actionRequired:"Monitorar tempo de atendimento e considerar otimiza\xe7\xf5es",timestamp:new Date().toISOString()}),t}async function eC(e){try{if(await em.generateClinicInsights(e))return{dischargeCandidates:[{patientName:"Maria Silva",probability:92,expectedDate:"2024-02-15"},{patientName:"Jo\xe3o Santos",probability:87,expectedDate:"2024-02-20"},{patientName:"Ana Costa",probability:78,expectedDate:"2024-02-25"}],riskPatients:[{patientName:"Pedro Oliveira",riskFactors:["Faltas frequentes","Dor persistente","Baixa ades\xe3o aos exerc\xedcios"],recommendedActions:["Reagendar consulta de acompanhamento","Revisar plano de exerc\xedcios","Contato telef\xf4nico para suporte"]},{patientName:"Carla Lima",riskFactors:["Progresso lento","Complexidade do caso"],recommendedActions:["Considerar refer\xeancia para especialista","Intensificar acompanhamento","Avalia\xe7\xe3o de exames complementares"]}]}}catch(e){O.aw.error("Failed to get AI predictions",{error:e})}return{dischargeCandidates:[],riskPatients:[]}}let ew=new f.AppRouteRouteModule({definition:{kind:E.x.APP_ROUTE,page:"/api/analytics/advanced/route",pathname:"/api/analytics/advanced",filename:"route",bundlePath:"app/api/analytics/advanced/route"},resolvedPagePath:"C:\\Users\\amand\\Rafael\\aifisio\\fisioflow-aistudio\\app\\api\\analytics\\advanced\\route.ts",nextConfigOutput:"standalone",userland:g}),{requestAsyncStorage:eA,staticGenerationAsyncStorage:eO,serverHooks:ev}=ew,eT="/api/analytics/advanced/route";function eI(){return(0,y.patchFetch)({serverHooks:ev,staticGenerationAsyncStorage:eO})}},90455:(e,t,n)=>{n.d(t,{I8:()=>d,handlers:()=>u,ts:()=>p});var a=n(96708),s=n(80772),i=n(7585),r=n(49237),o=n(42023),c=n.n(o);let l={adapter:(0,i.N)(r._B),providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await r._B.user.findUnique({where:{email:e.email}});if(!t||!t.passwordHash||!await c().compare(e.password,t.passwordHash))return null;return{id:t.id,email:t.email,name:t.name,role:t.role,avatarUrl:t.avatarUrl||void 0}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt",maxAge:2592e3},jwt:{maxAge:2592e3},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.avatarUrl=t.avatarUrl),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.role=t.role,e.user.avatarUrl=t.avatarUrl),e)},pages:{signIn:"/login",error:"/login"},secret:process.env.NEXTAUTH_SECRET},{auth:d,handlers:u,signIn:h,signOut:m}=(0,a.ZP)(l);async function p(){let e=await d();return e?.user||null}},16836:(e,t,n)=>{n.d(t,{M3:()=>r,cj:()=>c});var a=n(87070),s=n(33866),i=n(67754);async function r(e,t,n){return(0,i.O$)(`external.${e}.${t}`,n)}async function o(e,t){let n=Date.now();return{result:await t(),duration:Date.now()-n}}function c(){var e;return e=async e=>{let t=await o("health.check",async()=>{let e=process.memoryUsage(),t=process.uptime(),n={database:{status:"unknown",responseTime:0},redis:{status:"unknown",responseTime:0},memory:{status:e.heapUsed/e.heapTotal<.9?"healthy":"warning",usage:{used:Math.round(e.heapUsed/1024/1024),total:Math.round(e.heapTotal/1024/1024),percentage:Math.round(e.heapUsed/e.heapTotal*100)}},system:{status:"healthy",nodeVersion:process.version,platform:process.platform}};try{let{duration:e}=await o("database.ping",async()=>(await new Promise(e=>setTimeout(e,10)),!0));n.database={status:"healthy",responseTime:e}}catch(e){n.database={status:"unhealthy",responseTime:0,error:e.message}}try{let{duration:e}=await o("redis.ping",async()=>(await new Promise(e=>setTimeout(e,5)),!0));n.redis={status:"healthy",responseTime:e}}catch(e){n.redis={status:"unhealthy",responseTime:0,error:e.message}}return{status:Object.values(n).every(e=>"healthy"===e.status)?"healthy":"unhealthy",timestamp:new Date().toISOString(),uptime:Math.round(t),version:process.env.npm_package_version||"1.0.0",environment:"production",checks:n}});return a.NextResponse.json({...t.result,responseTime:t.duration})},async t=>{let n;let r=Date.now(),o=process.memoryUsage(),c=t.method||"GET",l=t.url||"",d=t.headers.get("user-agent")||"unknown",u=t.headers.get("x-forwarded-for")||t.headers.get("x-real-ip")||"unknown",h=200;try{h=(n=await (0,i.O$)(`api.${c.toLowerCase()}.${l.split("?")[0]}`,()=>e(t))).status,i.B1.recordAPICall(l,c,h)}catch(e){h=500,s.aw.error("API handler error",{method:c,url:l,error:e.message,stack:e.stack,userAgent:d,ip:u}),n=a.NextResponse.json({error:"Internal Server Error"},{status:500})}let m=Date.now()-r,p=process.memoryUsage(),g={rss:p.rss-o.rss,heapTotal:p.heapTotal-o.heapTotal,heapUsed:p.heapUsed-o.heapUsed,external:p.external-o.external};return s.aw.logAPICall(c,l,h,m,{ip:u,userAgent:d,memoryDelta:g}),n.headers.set("X-Response-Time",`${m}ms`),n.headers.set("X-Memory-Usage",JSON.stringify(g)),m>1e3&&s.aw.warn("Slow API request detected",{method:c,url:l,duration:m,statusCode:h,memoryDelta:g}),n}}},33866:(e,t,n)=>{n.d(t,{aw:()=>l});let a=require("winston");var s=n.n(a);s().addColors({error:"red",warn:"yellow",info:"green",http:"magenta",debug:"white"}),s().format.combine(s().format.timestamp({format:"YYYY-MM-DD HH:mm:ss:ms"}),s().format.colorize({all:!0}),s().format.printf(e=>{let{timestamp:t,level:n,message:a,...s}=e,i=Object.keys(s).length?JSON.stringify(s,null,2):"";return`${t} [${n}]: ${a} ${i}`}));let i=s().format.combine(s().format.timestamp(),s().format.errors({stack:!0}),s().format.json()),r=[];r.push(new(s()).transports.Console({format:i})),r.push(new(s()).transports.File({filename:"logs/error.log",level:"error",format:i}),new(s()).transports.File({filename:"logs/combined.log",format:i}));let o=s().createLogger({level:process.env.LOG_LEVEL||"info",levels:{error:0,warn:1,info:2,http:3,debug:4},format:i,transports:r,exitOnError:!1});class c{constructor(e){this.baseLogger=e}log(e,t,n){this.baseLogger.log(e,t,n)}error(e,t){this.log("error",e,t)}warn(e,t){this.log("warn",e,t)}info(e,t){this.log("info",e,t)}http(e,t){this.log("http",e,t)}debug(e,t){this.log("debug",e,t)}logAPICall(e,t,n,a,s){this.http(`${e} ${t} ${n}`,{...s,method:e,url:t,statusCode:n,duration:a})}logDatabaseQuery(e,t,n){this.debug("Database query executed",{...n,query:e.substring(0,100)+(e.length>100?"...":""),duration:t})}logCacheOperation(e,t,n){this.debug(`Cache ${e}`,{...n,operation:e,key:t})}logBusinessEvent(e,t,n){this.info(`Business event: ${e}`,{...n,event:e,...t})}logSecurityEvent(e,t,n){this.warn(`Security event: ${e}`,{...n,event:e,...t})}}let l=new c(o)},67754:(e,t,n)=>{n.d(t,{B1:()=>r,O$:()=>o});var a=n(33866);class s{record(e,t,n="count",a={}){this.metrics.push({name:e,value:t,unit:n,timestamp:new Date,tags:a}),this.metrics.length>1e3&&(this.metrics=this.metrics.slice(-1e3))}recordPerformance(e,t,n="success",a){this.performanceMetrics.push({operation:e,duration:t,status:n,metadata:a}),this.performanceMetrics.length>500&&(this.performanceMetrics=this.performanceMetrics.slice(-500))}getSummary(){let e=this.metrics.length,t=this.performanceMetrics.length,n=this.performanceMetrics.filter(e=>"success"===e.status),a=n.length>0?n.reduce((e,t)=>e+t.duration,0)/n.length:0,s=t>0?this.performanceMetrics.filter(e=>"error"===e.status).length/t*100:0;return{totalMetrics:e,totalPerformanceMetrics:t,averageResponseTime:Math.round(100*a)/100,errorRate:Math.round(100*s)/100}}getRecentMetrics(e=50){return this.metrics.slice(-e)}getRecentPerformanceMetrics(e=50){return this.performanceMetrics.slice(-e)}clear(){this.metrics=[],this.performanceMetrics=[]}constructor(){this.metrics=[],this.performanceMetrics=[]}}let i=new s;class r{static recordAPICall(e,t,n){i.record("api_calls_total",1,"count",{endpoint:e,method:t,status:n.toString()}),a.aw.http("API call recorded",{endpoint:e,method:t,statusCode:n,timestamp:new Date().toISOString()})}static recordBusinessEvent(e,t={}){i.record("business_events",1,"count",{eventType:e,...t}),a.aw.info("Business event recorded",{eventType:e,metadata:t,timestamp:new Date().toISOString()})}static recordSecurityEvent(e,t){i.record("security_events",1,"count",{type:e,severity:t}),a.aw.logSecurityEvent("Security event recorded",{type:e,severity:t,timestamp:new Date().toISOString()})}static recordPerformance(e,t,n="success"){i.recordPerformance(e,t,n),a.aw.info("Performance recorded",{operation:e,duration:t,status:n,timestamp:new Date().toISOString()})}}async function o(e,t){let n=Date.now();try{let a=await t(),s=Date.now()-n;return r.recordPerformance(e,s,"success"),a}catch(a){let t=Date.now()-n;throw r.recordPerformance(e,t,"error"),a}}},49303:(e,t,n)=>{e.exports=n(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[276,70,984,318,237],()=>n(81064));module.exports=a})();